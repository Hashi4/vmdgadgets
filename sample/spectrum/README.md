# スペクトラムメーターのモーション
* waveファイルを読んでスペクトラムメーターのモーションを作成します。
* 大量のフレームを生成するので重たいです。
    * MMDは1つのオブジェクトに対して2万フレームの登録が上限の様です。
* それっぽい動きをしますが、検証していないです。

## 必要なもの
* Python3系の他、numpyのインストールが必要です。
    * `python -m pip install numpy`
* 解析するwave ファイル。
    * 16bit 2チャンネルまで。
* このリポジトリのコピー

## サンプルのメーター設定を使う場合の手順
1. サンプルバッチファイルにwaveファイルをドラッグ&ドロップします。
    * floor\_meter.bat: 大き目のメーター用。
    * mini\_meter.bat: 小さめのメーター用。
    * 拡張子が.csvのファイルが出来上がります。
    * 拡張子が.vmdのファイルが出来上がります。
        * 登録フレーム数が2万点を超える場合、vmdファイルを複数作成します。
2. 出来上がったcsvファイルをpmxエディタへドラッグ&ドロップします。
    * 好みでモデルを変更してください、後述の設定ファイル編集でもある程度は変えられます。
    * 名前を付けてpmxファイル保存します。
3. mmdへモデル(.pmx)とモーション(.vmd)を登録します。
    * 2万点を超える場合、同じモデルを複数個登録します 。
4. 再生で動くハズ。

## 設定を変える場合の手順
1. 設定ファイルはjson形式です。サンプルの.jsonファイルをコピーし変更してください。
    * 項目は後述。utf-8前提です。
2. サンプルバッチファイルの1行目を新たに作成した設定jsonファイル名に変更し、上記と同様に実行します。
3. バッチファイルを用いない場合、モデル生成はコマンドプロンプトから以下を実行してください。
    * `python meter.py jsonファイル名 > CSVファイル名`
    * csvファイルをpmxエディタでインポートしてください。
4. モーション作成は以下です。
    * `python ..\..\vmdgadgets\spectrum.py --config jsonファイル名 waveファイル名`
    * .vmdファイルができます。

## 設定項目
変えたことがないものばかりで、設定値によっては異常終了したり変な結果を出力すると思います。

モデル生成とモーション生成との両方が参照します。
* FFT\_SAMPLE: 高速フーリエ変換で変換する標本点数です。
    * 2の冪乗である必要があります。
* BAND\_DEFS, BANDS: メータの横軸周波数設定です。
* MIN\_DB: 最低デシベル値です、これより下はこの値で扱います。
* FRAME\_INCR: フレームを打込む間隔。フレームはMMDのフレームです(30frame/sec)。
* VMD\_MAX\_FRAME: VMD1ファイル当たりの最大登録フレーム数
* BAR\_WIDTH: メータの横幅。
* BAR\_SPACE: メータ間の隙間。
* BAR\_HEIGHT: メータの縦幅
    * = ボーンの移動幅。
* BAR\_RGB: メータの拡散及び環境色。
    * 反射色はAutoLuminous用に0。
* BAR\_TRANSPARENCY: メータの不透明度。
* METER\_BONE\_NAME: メータとしてY軸移動させるのボーン名称。
    * {0}はPythonの記法で、0始まりでメータの番号が入ります。
* USER\_METER\_MORPH: ボーンの直接移動ではなく、ボーンモーフを変更させる場合true。
    * モーフは補間曲線を使えません。
* VIEW\_MORPH\_NAME: メータ変動と連動して変化させるモーフ名。
* VIEW\_MORPH\_SCALE: モーフ値変更の倍率。
* USE\_VIEW\_MORPH: モーフ出力する場合true。
* METER\_MODEL\_NAME: メータのモデル名。
